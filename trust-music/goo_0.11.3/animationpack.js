/* Goo Engine animationpack 0.11.3
 * Copyright 2014 Goo Technologies AB
 */
(function(window){function f(){
define("goo/animationpack/Joint",["goo/math/Transform"],function(e){function t(t){this._name=t,this._index=0,this._parentIndex=0,this._inverseBindPose=new e}return t.NO_PARENT=-32768,t}),define("goo/animationpack/Skeleton",["goo/animationpack/Joint"],function(e){function t(e,t){this._name=e,this._joints=t}return t.prototype.clone=function(){var n=this._name,r=this._joints,i=[];for(var s=0,o=r.length;s<o;s++){var u=r[s],a=u._name,f=new e(a);f._index=u._index,f._parentIndex=u._parentIndex,f._inverseBindPose.copy(u._inverseBindPose),f._inverseBindPose.update(),i[s]=f}return new t(n,i)},t}),define("goo/animationpack/SkeletonPose",["goo/math/Transform","goo/animationpack/Joint","goo/math/Matrix4x4"],function(e,t,n){function r(t){this._skeleton=t,this._localTransforms=[],this._globalTransforms=[],this._matrixPalette=[],this._poseListeners=[];var r=this._skeleton._joints.length;for(var i=0;i<r;i++)this._localTransforms[i]=new e;for(var i=0;i<r;i++)this._globalTransforms[i]=new e;for(var i=0;i<r;i++)this._matrixPalette[i]=new n;this.setToBindPose()}return r.prototype.setToBindPose=function(){for(var e=0;e<this._localTransforms.length;e++){this._localTransforms[e].matrix.copy(this._skeleton._joints[e]._inverseBindPose.matrix).invert();var r=this._skeleton._joints[e]._parentIndex;r!==t.NO_PARENT&&n.combine(this._skeleton._joints[r]._inverseBindPose.matrix,this._localTransforms[e].matrix,this._localTransforms[e].matrix)}this.updateTransforms()},r.prototype.updateTransforms=function(){for(var e=0;e<this._skeleton._joints.length;e++){var r=this._skeleton._joints[e]._parentIndex;r!==t.NO_PARENT?n.combine(this._globalTransforms[r].matrix,this._localTransforms[e].matrix,this._globalTransforms[e].matrix):this._globalTransforms[e].matrix.copy(this._localTransforms[e].matrix),n.combine(this._globalTransforms[e].matrix,this._skeleton._joints[e]._inverseBindPose.matrix,this._matrixPalette[e])}this.firePoseUpdated()},r.prototype.firePoseUpdated=function(){for(var e=this._poseListeners.length-1;e>=0;e--)this._poseListeners[e].poseUpdated(this)},r.prototype.clone=function(){return new r(this._skeleton)},r}),define("goo/animationpack/clip/TransformData",["goo/math/Quaternion","goo/math/Vector3"],function(e,t){function n(n){this._rotation=(new e).copy(n?n._rotation:e.IDENTITY),this._scale=(new t).copy(n?n._scale:t.ONE),this._translation=(new t).copy(n?n._translation:t.ZERO)}return n.prototype.applyTo=function(e){e.setIdentity(),e.rotation.copyQuaternion(this._rotation),e.scale.setv(this._scale),e.translation.setv(this._translation),e.update()},n.prototype.set=function(e){this._rotation.copy(e._rotation),this._scale.copy(e._scale),this._translation.copy(e._translation)},n.prototype.blend=function(t,r,i){var s=i?i:new n;return s._translation.setv(this._translation).lerp(t._translation,r),s._scale.setv(this._scale).lerp(t._scale,r),e.slerp(this._rotation,t._rotation,r,s._rotation),s},n}),define("goo/animationpack/blendtree/BinaryLERPSource",["goo/math/MathUtils","goo/animationpack/clip/TransformData"],function(e,t){function n(e,t,n){this._sourceA=e?e:null,this._sourceB=t?t:null,this.blendWeight=n?n:null}return n.prototype.getSourceData=function(){var e=this._sourceA?this._sourceA.getSourceData():null,t=this._sourceB?this._sourceB.getSourceData():null;return n.combineSourceData(e,t,this.blendWeight)},n.prototype.setTime=function(e){var t=!1,n=!1;return this._sourceA&&(t=this._sourceA.setTime(e)),this._sourceB&&(n=this._sourceB.setTime(e)),t||n},n.prototype.resetClips=function(e){this._sourceA&&this._sourceA.resetClips(e),this._sourceB&&this._sourceB.resetClips(e)},n.prototype.shiftClipTime=function(e){this._sourceA&&this._sourceA.shiftClipTime(e),this._sourceB&&this._sourceB.shiftClipTime(e)},n.prototype.setTimeScale=function(e){this._sourceA.setTimeScale(e),this._sourceB.setTimeScale(e)},n.prototype.isActive=function(){var e=!1;return this._sourceA&&(e=e||this._sourceA.isActive()),this._sourceB&&(e=e||this._sourceB.isActive()),e},n.combineSourceData=function(e,r,i,s){if(!r)return e;if(!e)return r;var o=s?s:{};for(var u in e){var a=e[u],f=r[u];if(!isNaN(a)){n.blendFloatValues(o,u,i,a,f);continue}if(!(a instanceof t)){o[u]=a;continue}f?o[u]=a.blend(f,i,o[u]):o[u]?o[u].set(a):o[u]=new a.constructor(a)}for(var u in r){if(o[u])continue;o[u]=r[u]}return o},n.blendFloatValues=function(t,n,r,i,s){isNaN(s)?t[n]=i:t[n]=e.lerp(r,i[0],s[0])},n.prototype.clone=function(){return new n(this._sourceA,this._sourceB,this._blendWeight)},n}),define("goo/animationpack/clip/AnimationClipInstance",["goo/entities/World"],function(e){function t(){this._active=!0,this._loopCount=0,this._timeScale=1,this._startTime=0,this._prevClockTime=0,this._prevUnscaledClockTime=0,this._clipStateObjects={}}return t.prototype.setTimeScale=function(t,n){n=typeof n!="undefined"?n:e.time;if(this._active&&this._timeScale!==t)if(this._timeScale!==0&&t!==0){var r=n,i=r-this._startTime;i*=this._timeScale,i/=t,this._startTime=r-i}else if(this._timeScale===0){var r=n;this._startTime=r-this._prevUnscaledClockTime}this._timeScale=t},t.prototype.getApplyTo=function(e){var t=e._channelName,n=this._clipStateObjects[t];return n||(n=e.createStateDataObject(),this._clipStateObjects[t]=n),n},t.prototype.clone=function(){var e=new t;return e._active=this._active,e._loopCount=this._loopCount,e._timeScale=this._timeScale,e},t}),define("goo/animationpack/blendtree/ClipSource",["goo/math/MathUtils","goo/animationpack/clip/AnimationClipInstance"],function(e,t){function n(e,n,r){this._clip=e,this._clipInstance=new t,this._filterChannels={},this._filter=null,this.setFilter(n,r),this._startTime=-Infinity,this._endTime=Infinity}return n.prototype.setFilter=function(e,t){if(e&&t){this._filter=["Exclude","Include"].indexOf(e)>-1?e:null;for(var n=0;n<t.length;n++)this._filterChannels[t[n]]=!0}else this._filter=null},n.prototype.setTime=function(t){var n=this._clipInstance;typeof n._startTime!="number"&&(n._startTime=t);var r,i;if(n._active){n._timeScale!==0?(n._prevUnscaledClockTime=t-n._startTime,r=n._timeScale*n._prevUnscaledClockTime,n._prevClockTime=r):r=n._prevClockTime;var s=Math.min(this._clip._maxTime,this._endTime),o=Math.max(this._startTime,0);i=s-o;if(s===-1)return!1;if(s!==0){n._loopCount===-1?r<0?(r*=-1,r%=i,r=i-r,r+=o):(r%=i,r+=o):n._loopCount>0&&i*n._loopCount>=Math.abs(r)&&(r<0?(r*=-1,r%=i,r=i-r,r+=o):(r%=i,r+=o));if(r>s||r<o)r=e.clamp(r,o,s),n._active=!1}this._clip.update(r,n)}return n._active},n.prototype.resetClips=function(e){this._clipInstance._startTime=typeof e!="undefined"?e:0,this._clipInstance._active=!0},n.prototype.shiftClipTime=function(e){this._clipInstance._startTime+=e,this._clipInstance._active=!0},n.prototype.setTimeScale=function(e){this._clipInstance.setTimeScale(e)},n.prototype.isActive=function(){return this._clipInstance._active&&this._clip._maxTime!==-1},n.prototype.getSourceData=function(){if(!this._filter||!this._filterChannels)return this._clipInstance._clipStateObjects;var e=this._clipInstance._clipStateObjects,t={},n=this._filter==="Include";for(var r in e)this._filterChannels[r]!==undefined===n&&(t[r]=e[r]);return t},n.prototype.clone=function(){var e=new n(this._clip);e._clipInstance=this._clipInstance.clone(),e._filter=this._filter;for(var t in this._filterChannels)e._filterChannels[t]=this._filterChannels[t];return e._startTime=this._startTime,e._endTime=this._endTime,e},n}),define("goo/animationpack/blendtree/FrozenClipSource",[],function(){function e(e,t){this._source=e,this._time=t}return e.prototype.getSourceData=function(){return this._source.getSourceData()},e.prototype.resetClips=function(){this._source.resetClips(0)},e.prototype.setTime=function(){return this._source.setTime(this._time),!0},e.prototype.isActive=function(){return!0},e.prototype.setTimeScale=function(){},e.prototype.clone=function(){var t=new e(this._source.clone(),this._time);return t},e}),define("goo/animationpack/clip/AbstractAnimationChannel",[],function(){function e(e,t,n){this._blendType=n||"Linear",this._channelName=e,(t instanceof Array||t instanceof Float32Array)&&t.length?this._times=new Float32Array(t):this._times=[],this._lastStartFrame=0}return e.prototype.getSampleCount=function(){return this._times.length},e.prototype.getMaxTime=function(){return this._times.length?this._times[this._times.length-1]:0},e.prototype.updateSample=function(e,t){var n=this._times.length;if(!n)return;var r=n-1;if(e<0||n===1)this.setCurrentSample(0,0,t);else if(e>=this._times[r])this.setCurrentSample(r,0,t);else{var i=0;if(e>=this._times[this._lastStartFrame]){i=this._lastStartFrame;for(var s=this._lastStartFrame;s<n-1;s++){if(this._times[s]>=e)break;i=s}}else for(var s=0;s<this._lastStartFrame;s++){if(this._times[s]>=e)break;i=s}var o=(e-this._times[i])/(this._times[i+1]-this._times[i]);this.setCurrentSample(i,o,t),this._lastStartFrame=i}},e}),define("goo/animationpack/clip/TransformChannel",["goo/animationpack/clip/AbstractAnimationChannel","goo/animationpack/clip/TransformData","goo/math/Quaternion"],function(e,t,n){function r(t,n,r,i,s,o){e.call(this,t,n,o);if(r.length/4!==n.length||i.length/3!==n.length||s.length/3!==n.length)throw new Error("All provided arrays must be the same length (accounting for type)! Channel: "+t);this._rotations=new Float32Array(r),this._translations=new Float32Array(i),this._scales=new Float32Array(s)}var i=new n,s=new n;return r.prototype=Object.create(e.prototype),r.prototype.createStateDataObject=function(){return new t},r.prototype.setCurrentSample=function(e,t,r){var o=r,u=e*4,a=e*3,f=(e+1)*4,l=(e+1)*3;if(t===0){o._rotation.data[0]=this._rotations[u+0],o._rotation.data[1]=this._rotations[u+1],o._rotation.data[2]=this._rotations[u+2],o._rotation.data[3]=this._rotations[u+3],o._translation.data[0]=this._translations[a+0],o._translation.data[1]=this._translations[a+1],o._translation.data[2]=this._translations[a+2],o._scale.data[0]=this._scales[a+0],o._scale.data[1]=this._scales[a+1],o._scale.data[2]=this._scales[a+2];return}if(t===1){o._rotation.data[0]=this._rotations[f+0],o._rotation.data[1]=this._rotations[f+1],o._rotation.data[2]=this._rotations[f+2],o._rotation.data[3]=this._rotations[f+3],o._translation.data[0]=this._translations[l+0],o._translation.data[1]=this._translations[l+1],o._translation.data[2]=this._translations[l+2],o._scale.data[0]=this._scales[l+0],o._scale.data[1]=this._scales[l+1],o._scale.data[2]=this._scales[l+2];return}o._rotation.data[0]=this._rotations[u+0],o._rotation.data[1]=this._rotations[u+1],o._rotation.data[2]=this._rotations[u+2],o._rotation.data[3]=this._rotations[u+3],i.data[0]=this._rotations[f+0],i.data[1]=this._rotations[f+1],i.data[2]=this._rotations[f+2],i.data[3]=this._rotations[f+3],o._rotation.equals(i)||(n.slerp(o._rotation,i,t,s),o._rotation.setv(s)),o._translation.data[0]=(1-t)*this._translations[a+0]+t*this._translations[l+0],o._translation.data[1]=(1-t)*this._translations[a+1]+t*this._translations[l+1],o._translation.data[2]=(1-t)*this._translations[a+2]+t*this._translations[l+2],o._scale.data[0]=(1-t)*this._scales[a+0]+t*this._scales[l+0],o._scale.data[1]=(1-t)*this._scales[a+1]+t*this._scales[l+1],o._scale.data[2]=(1-t)*this._scales[a+2]+t*this._scales[l+2]},r.prototype.getData=function(e,n){var r=n?n:new t;return this.setCurrentSample(e,0,r),r},r}),define("goo/animationpack/clip/JointData",["goo/animationpack/clip/TransformData"],function(e){function t(t){e.call(this,t),this._jointIndex=t?t._jointIndex:0}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.set=function(t){e.prototype.set.call(this,t),this._jointIndex=t._jointIndex},t.prototype.blend=function(n,r,i){var s=i;return s?s instanceof t&&(s._jointIndex=this._jointIndex):(s=new t,s._jointIndex=this._jointIndex),e.prototype.blend.call(this,n,r,s)},t.prototype.clone=function(){return new t(this)},t}),define("goo/animationpack/clip/JointChannel",["goo/animationpack/clip/TransformChannel","goo/animationpack/clip/JointData"],function(e,t){function n(t,n,r,i,s,o,u){e.call(this,n,r,i,s,o,u),this._jointName=n,this._jointIndex=t}return n.prototype=Object.create(e.prototype),n.JOINT_CHANNEL_NAME="_jnt",n.prototype.createStateDataObject=function(){return new t},n.prototype.setCurrentSample=function(t,n,r){e.prototype.setCurrentSample.call(this,t,n,r),r._jointIndex=this._jointIndex},n.prototype.getData=function(n,r){var i=r?r:new t;return e.prototype.getData.call(this,n,i),i._jointIndex=this._jointIndex,i},n}),define("goo/animationpack/blendtree/ManagedTransformSource",["goo/animationpack/clip/JointChannel","goo/animationpack/clip/JointData","goo/animationpack/clip/JointChannel","goo/animationpack/clip/JointData","goo/math/Vector3","goo/math/Quaternion"],function(e,t,n,r,i,s){function o(e){this._sourceName=e?e:null,this._data={}}return o.prototype.setTranslation=function(e,t){var n=this._data[e];n instanceof r&&n._translation.setv(t)},o.prototype.getTranslation=function(e,t){var n=this._data[e];return n instanceof r&&(t=t||new i,t.setv(n._translation)),t},o.prototype.setScale=function(e,t){var n=this._data[e];n instanceof r&&n._scale.setv(t)},o.prototype.getScale=function(e,t){var n=this._data[e];return n instanceof r&&(t=t||new i,t.setv(n._scale)),t},o.prototype.setRotation=function(e,t){var n=this._data[e];n instanceof r&&n._rotation.set(t)},o.prototype.getRotation=function(e,t){var n=this._data[e];return n instanceof r&&(t=t||new s,t.setv(n._rotation)),t},o.prototype.initFromClip=function(e,t,n){if(t==="Include"&&n&&n.length)for(var r=0,i=n.length;r<i;r++){var s=n[r],o=e.findChannelByName(s);if(o){var u=o.getData(0);this._data[s]=u}else console.error("Channel not in clip: "+s)}else for(var r=0,i=e._channels.length;r<i;r++){var o=e._channels[r],s=o._channelName;if(t==="Exclude"&&n&&n.length&&n.indexOf(s)>-1){var u=o.getData(0);this._data[s]=u}}},o.prototype.resetClips=function(){},o.prototype.setTimeScale=function(){},o.prototype.setTime=function(){return!0},o.prototype.isActive=function(){return!0},o.prototype.getChannelData=function(e){return this._data[e]},o.prototype.getSourceData=function(){return this._data},o.prototype.clone=function(){var e={};for(var t in this._data)e[t]=this._data[t].clone();return new o(this._sourceName,e)},o}),define("goo/animationpack/clip/AnimationClip",[],function(){function e(e,t){this._name=e,this._channels=t||[],this._maxTime=-1,this.updateMaxTimeIndex()}return e.prototype.update=function(e,t){for(var n=0,r=this._channels.length;n<r;++n){var i=this._channels[n],s=t.getApplyTo(i);i.updateSample(e,s)}},e.prototype.addChannel=function(e){this._channels.push(e),this.updateMaxTimeIndex()},e.prototype.removeChannel=function(e){var t=this._channels.indexOf(e);return t>=0?(this._channels.splice(t,1),this.updateMaxTimeIndex(),!0):!1},e.prototype.findChannelByName=function(e){for(var t=0,n=this._channels.length;t<n;++t){var r=this._channels[t];if(e===r._channelName)return r}return null},e.prototype.updateMaxTimeIndex=function(){this._maxTime=-1;var e;for(var t=0;t<this._channels.length;t++){var n=this._channels[t];e=n.getMaxTime(),e>this._maxTime&&(this._maxTime=e)}},e.prototype.toString=function(){return this._name+": "+this._channels.map(function(e){return e._channelName})},e}),define("goo/animationpack/clip/InterpolatedFloatChannel",["goo/animationpack/clip/AbstractAnimationChannel","goo/math/MathUtils"],function(e,t){function n(t,n,r,i){e.call(this,t,n,i),this._values=r?r.slice(0):null}return n.prototype=Object.create(e.prototype),n.prototype.createStateDataObject=function(){return[0]},n.prototype.setCurrentSample=function(e,n,r){r[0]=t.lerp(n,this._values[e],this._values[e+1])},n.prototype.getData=function(e,t){var n=t||[];return n[0]=this._values[e],n},n}),define("goo/animationpack/clip/TriggerData",[],function(){function e(){this._currentTriggers=[],this._currentIndex=-1,this.armed=!1}return e.prototype.arm=function(e,t){if(t===null||t.length===0)this._currentTriggers.length=0,this.armed=!1;else if(e!==this._currentIndex){this._currentTriggers.length=0;for(var n=0,r=t.length;n<r;n++)t[n]&&t[n]!==""&&this._currentTriggers.push(t[n]);this.armed=!0}this._currentIndex=e},e}),define("goo/animationpack/clip/TriggerChannel",["goo/animationpack/clip/AbstractAnimationChannel","goo/animationpack/clip/TriggerData"],function(e,t){function n(t,n,r,i){e.call(this,t,n,i),this._keys=r?r.slice(0):null,this.guarantee=!1}return n.prototype=Object.create(e.prototype),n.prototype.createStateDataObject=function(){return new t},n.prototype.setCurrentSample=function(e,t,n){var r=n._currentIndex,i=t!==1?e:e+1;if(r===i||!this.guarantee)n.arm(i,[this._keys[i]]);else{var s=[];if(r>i){for(var o=r+1;o<this._keys.length;o++)s.push(this._keys[o]);r=-1}for(var o=r+1;o<=i;o++)s.push(this._keys[o]);n.arm(i,s)}},n}),define("goo/animationpack/state/AbstractState",[],function(){function e(){this._globalStartTime=0,this.onFinished=null}return e.prototype.update=function(){},e.prototype.postUpdate=function(){},e.prototype.getCurrentSourceData=function(){},e.prototype.resetClips=function(e){this._globalStartTime=e},e.prototype.shiftClipTime=function(e){this._globalStartTime+=e},e}),define("goo/animationpack/state/AbstractTransitionState",["goo/animationpack/state/AbstractState","goo/animationpack/blendtree/BinaryLERPSource","goo/math/MathUtils"],function(e,t,n){function r(){e.call(this),this._sourceState=null,this._targetState=null,this._percent=0,this._sourceData=null,this._fadeTime=0,this._blendType="Linear"}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.update=function(e){var t=e-this._globalStartTime;if(t>this._fadeTime&&this.onFinished){this.onFinished();return}var r=t/this._fadeTime;switch(this._blendType){case"SCurve3":this._percent=n.scurve3(r);break;case"SCurve5":this._percent=n.scurve5(r);break;default:this._percent=r}},r.prototype.readFromConfig=function(e){e&&(e.fadeTime!==undefined&&(this._fadeTime=e.fadeTime),e.blendType!==undefined&&(this._blendType=e.blendType))},r.prototype.getCurrentSourceData=function(){var e=this._sourceState?this._sourceState.getCurrentSourceData():null,n=this._targetState?this._targetState.getCurrentSourceData():null;return this._sourceData||(this._sourceData={}),t.combineSourceData(e,n,this._percent,this._sourceData)},r.prototype.isValid=function(e,t){var n=t-this._sourceState._globalStartTime,r=e[0],i=e[1];return r<=0?i<=0?!0:n<=i:i<=0?n>=r:r<=i?r<=n&&n<=i:n>=r||n<=i},r.prototype.resetClips=function(t){e.prototype.resetClips.call(this,t),this._percent=0},r.prototype.shiftClipTime=function(t){e.prototype.shiftClipTime.call(this,t)},r.prototype.setTimeScale=function(e){this._sourceState&&this._sourceState.setTimeScale(e),this._targetState&&this._targetState.setTimeScale(e)},r}),define("goo/animationpack/state/FadeTransitionState",["goo/animationpack/state/AbstractTransitionState"],function(e){function t(){e.call(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.update=function(t){e.prototype.update.call(this,t),this._sourceState&&this._sourceState.update(t),this._targetState&&this._targetState.update(t)},t.prototype.postUpdate=function(){this._sourceState&&this._sourceState.postUpdate(),this._targetState&&this._targetState.postUpdate()},t.prototype.resetClips=function(t){e.prototype.resetClips.call(this,t),this._targetState&&this._targetState.resetClips(t)},t.prototype.shiftClipTime=function(t){e.prototype.shiftClipTime.call(this,t),this._targetState&&this._targetState.shiftClipTime(t),this._sourceState&&this._sourceState.shiftClipTime(t)},t}),define("goo/animationpack/state/SyncFadeTransitionState",["goo/animationpack/state/FadeTransitionState"],function(e){function t(){e.call(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.resetClips=function(t){e.prototype.resetClips.call(this,t),this._targetState.resetClips(this._sourceState._globalStartTime)},t.prototype.shiftClipTime=function(t){e.prototype.shiftClipTime.call(this,t),this._targetState.shiftClipTime(this._sourceState._globalStartTime+t),this._sourceState.shiftClipTime(t)},t}),define("goo/animationpack/state/FrozenTransitionState",["goo/animationpack/state/AbstractTransitionState"],function(e){function t(){e.call(this)}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.update=function(t){e.prototype.update.call(this,t),this._targetState&&this._targetState.update(t)},t.prototype.postUpdate=function(){this._targetState&&this._targetState.postUpdate()},t.prototype.resetClips=function(t){e.prototype.resetClips.call(this,t),this._targetState.resetClips(t)},t.prototype.shiftClipTime=function(t){e.prototype.shiftClipTime.call(this,t),this._targetState.shiftClipTime(t)},t}),define("goo/animationpack/state/SteadyState",["goo/animationpack/state/AbstractState"],function(e){function t(t){e.call(this),this.id=null,this._name=t,this._transitions={},this._sourceTree=null}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.setClipSource=function(e){this._sourceTree=e},t.prototype.update=function(e){this._sourceTree.setTime(e)||this.onFinished&&this.onFinished()},t.prototype.getCurrentSourceData=function(){return this._sourceTree.getSourceData()},t.prototype.resetClips=function(t){e.prototype.resetClips.call(this,t),this._sourceTree.resetClips(t)},t.prototype.shiftClipTime=function(t){e.prototype.shiftClipTime.call(this,t),this._sourceTree.shiftClipTime(t)},t.prototype.setTimeScale=function(e){this._sourceTree.setTimeScale(e)},t.prototype.clone=function(){var e=new t(this._name);for(var n in this._transitions)e._transitions[n]=this._transitions[n];return e._sourceTree=this._sourceTree.clone(),e},t}),define("goo/animationpack/layer/LayerLERPBlender",["goo/animationpack/blendtree/BinaryLERPSource"],function(e){function t(){this._blendWeight=null,this._layerA=null,this._layerB=null}return t.prototype.getBlendedSourceData=function(){var t=this._layerA.getCurrentSourceData(),n=this._layerB._currentState?this._layerB._currentState.getCurrentSourceData():null;return e.combineSourceData(t,n,this._blendWeight)},t}),define("goo/animationpack/layer/AnimationLayer",["goo/animationpack/state/FadeTransitionState","goo/animationpack/state/SyncFadeTransitionState","goo/animationpack/state/FrozenTransitionState","goo/animationpack/state/SteadyState","goo/animationpack/layer/LayerLERPBlender","goo/entities/World","goo/math/MathUtils"],function(e,t,n,r,i,s,o){function u(e,t){this.id=t,this._name=e,this._steadyStates={},this._currentState=null,this._layerBlender=new i,this._transitions={},this._transitionStates={}}return u.BASE_LAYER_NAME="-BASE_LAYER-",u.prototype.getStates=function(){return Object.keys(this._steadyStates)},u.prototype.setState=function(e,t){this._steadyStates[e]=t},u.prototype.setBlendWeight=function(e){this._layerBlender&&(this._layerBlender._blendWeight=o.clamp(e,0,1))},u.prototype.getTransitions=function(){var e;this._currentState?e=Object.keys(this._currentState._transitions):e=[];if(this._transitions)for(var t in this._transitions)e.indexOf(t)===-1&&e.push(t);return e.sort(),e},u.prototype.update=function(e){this._currentState&&this._currentState.update(typeof e!="undefined"?e:s.time)},u.prototype.postUpdate=function(){this._currentState&&this._currentState.postUpdate()},u.prototype.transitionTo=function(e,t,n){t=typeof t!="undefined"?t:s.time;var i=this._currentState,o;if(this._steadyStates[e]===i)return!1;if(!this._steadyStates[e])return!1;i&&i._transitions&&(o=i._transitions[e]||i._transitions["*"]),!o&&this._transitions&&(o=this._transitions[e]||this._transitions["*"]);if(i instanceof r&&o){var u=this._getTransitionByType(o.type);return this._doTransition(u,i,this._steadyStates[e],o,t,n),!0}if(!i){o=this._transitions[e];if(o){var u=this._getTransitionByType(o.type);if(u)return this._doTransition(u,null,this._steadyStates[e],o,t,n),!0}}return!1},u.prototype._doTransition=function(e,t,n,r,i,s){if(t){e._sourceState=t;var o=r.timeWindow||[-1,-1];if(!e.isValid(o,i)){console.warn("State not in allowed time window");return}t.onFinished=null}e._targetState=n,e.readFromConfig(r),this.setCurrentState(e,!0,i,s)},u.prototype.setCurrentState=function(e,t,n,i){n=typeof n!="undefined"?n:s.time,this._currentState=e,e&&(t&&e.resetClips(n),e.onFinished=function(){this.setCurrentState(e._targetState||null,!1,undefined,i),e instanceof r&&i instanceof Function&&i(),this.update()}.bind(this))},u.prototype.getCurrentState=function(){return this._currentState},u.prototype.setCurrentStateById=function(e,t,n,r){var i=this.getStateById(e);this.setCurrentState(i,t,n,r)},u.prototype.getStateById=function(e){return this._steadyStates[e]},u.prototype.getStateByName=function(e){for(var t in this._steadyStates){var n=this._steadyStates[t];if(n._name===e)return this._steadyStates[t]}},u.prototype.setCurrentStateByName=function(e,t,n){if(e){var r=this.getStateByName(e);if(r)return this.setCurrentState(r,t,n),!0;console.warn("unable to find SteadyState named: "+e)}return!1},u.prototype.getCurrentSourceData=function(){return this._layerBlender?this._layerBlender.getBlendedSourceData():this._currentState?this._currentState.getCurrentSourceData():null},u.prototype.updateLayerBlending=function(e){this._layerBlender&&(this._layerBlender._layerA=e,this._layerBlender._layerB=this)},u.prototype.clearCurrentState=function(){this.setCurrentState(null)},u.prototype.resetClips=function(e){this._currentState&&this._currentState.resetClips(typeof e!="undefined"?e:s.time)},u.prototype.shiftClipTime=function(e){this._currentState&&this._currentState.shiftClipTime(typeof e!="undefined"?e:0)},u.prototype.setTimeScale=function(e){this._currentState&&this._currentState.setTimeScale(e)},u.prototype._getTransitionByType=function(r){if(this._transitionStates[r])return this._transitionStates[r];var i;switch(r){case"Fade":i=new e;break;case"SyncFade":i=new t;break;case"Frozen":i=new n;break;default:console.log("Defaulting to frozen transition type"),i=new n}return this._transitionStates[r]=i},u.prototype.clone=function(){var e=new u(this._name);for(var t in this._steadyStates)e._steadyStates[t]=this._steadyStates[t].clone(),this._steadyStates[t]===this._currentState&&(e._currentState=e._steadyStates[t]);for(var t in this._transitions)e._transitions[t]=this._transitions[t];for(var t in this._transitionStates)e._transitionStates[t]=new this._transitionStates[t].constructor;return e},u}),define("goo/animationpack/AnimationRegister",["goo/scripts/Scripts","goo/animationpack/Joint","goo/animationpack/Skeleton","goo/animationpack/SkeletonPose","goo/animationpack/blendtree/BinaryLERPSource","goo/animationpack/blendtree/ClipSource","goo/animationpack/blendtree/FrozenClipSource","goo/animationpack/blendtree/ManagedTransformSource","goo/animationpack/clip/AbstractAnimationChannel","goo/animationpack/clip/AnimationClip","goo/animationpack/clip/AnimationClipInstance","goo/animationpack/clip/InterpolatedFloatChannel","goo/animationpack/clip/JointChannel","goo/animationpack/clip/JointData","goo/animationpack/clip/TransformChannel","goo/animationpack/clip/TransformData","goo/animationpack/clip/TriggerChannel","goo/animationpack/clip/TriggerData","goo/animationpack/layer/AnimationLayer","goo/animationpack/layer/LayerLERPBlender","goo/animationpack/state/AbstractState","goo/animationpack/state/AbstractTransitionState","goo/animationpack/state/FadeTransitionState","goo/animationpack/state/FrozenTransitionState","goo/animationpack/state/SteadyState","goo/animationpack/state/SyncFadeTransitionState"],function(e){var t=["goo/scripts/Scripts","goo/animationpack/Joint","goo/animationpack/Skeleton","goo/animationpack/SkeletonPose","goo/animationpack/blendtree/BinaryLERPSource","goo/animationpack/blendtree/ClipSource","goo/animationpack/blendtree/FrozenClipSource","goo/animationpack/blendtree/ManagedTransformSource","goo/animationpack/clip/AbstractAnimationChannel","goo/animationpack/clip/AnimationClip","goo/animationpack/clip/AnimationClipInstance","goo/animationpack/clip/InterpolatedFloatChannel","goo/animationpack/clip/JointChannel","goo/animationpack/clip/JointData","goo/animationpack/clip/TransformChannel","goo/animationpack/clip/TransformData","goo/animationpack/clip/TriggerChannel","goo/animationpack/clip/TriggerData","goo/animationpack/layer/AnimationLayer","goo/animationpack/layer/LayerLERPBlender","goo/animationpack/state/AbstractState","goo/animationpack/state/AbstractTransitionState","goo/animationpack/state/FadeTransitionState","goo/animationpack/state/FrozenTransitionState","goo/animationpack/state/SteadyState","goo/animationpack/state/SyncFadeTransitionState"];for(var n=1;n<t.length;n++){var r=t[n].slice(t[n].lastIndexOf("/")+1);e.addClass(r,arguments[n])}}),define("goo/animationpack/components/AnimationComponent",["goo/entities/components/Component","goo/entities/World","goo/animationpack/layer/AnimationLayer","goo/animationpack/clip/JointData","goo/animationpack/clip/TransformData","goo/animationpack/clip/TriggerData"],function(e,t,n,r,i,s){function o(e){this.type="AnimationComponent",this.layers=[],this.floats={},this._updateRate=1/60,this._lastUpdate=0,this._triggerCallbacks={};var t=new n(n.BASE_LAYER_NAME);this.layers.push(t),this._skeletonPose=e,this.paused=!1,this.lastTimeOfPause=-1}return o.prototype=Object.create(e.prototype),o.prototype.transitionTo=function(e,t,n){return this.layers[0].transitionTo(e,undefined,n)?!0:t?this.layers[0].setCurrentStateById(e,!0,undefined,n):!1},o.prototype.getStates=function(){return this.layers[0].getStates()},o.prototype.getCurrentState=function(){return this.layers[0].getCurrentState()},o.prototype.getTransitions=function(){return this.layers[0].getTransitions()},o.prototype.update=function(e){if(this.paused)return;e=typeof e!="undefined"?e:t.time;if(this._updateRate!==0){if(e>this._lastUpdate&&e-this._lastUpdate<this._updateRate)return;this._lastUpdate=e-(e-this._lastUpdate)%this._updateRate}for(var n=0,r=this.layers.length;n<r;n++)this.layers[n].update(e)},o.prototype.apply=function(e){var t=this.getCurrentSourceData(),n=this._skeletonPose;if(t){var o=Object.keys(t);for(var u=0,a=o.length;u<a;u++){var f=o[u],l=t[f];if(l instanceof r)n&&l._jointIndex>=0&&l.applyTo(n._localTransforms[l._jointIndex]);else if(l instanceof i)e&&(l.applyTo(e.transform),e.updateTransform(),this._updateWorldTransform(e));else if(l instanceof s){if(l.armed){for(var u=0,c=l._currentTriggers.length;u<c;u++){var h=this._triggerCallbacks[l._currentTriggers[u]];if(h&&h.length)for(var p=0,d=h.length;p<d;p++)h[p]()}l.armed=!1}}else l instanceof Array&&(this.floats[f]=l[0])}n&&n.updateTransforms()}},o.prototype._updateWorldTransform=function(e){e.updateWorldTransform();for(var t=0;t<e.children.length;t++)this._updateWorldTransform(e.children[t])},o.prototype.postUpdate=function(){for(var e=0,t=this.layers.length;e<t;e++)this.layers[e].postUpdate()},o.prototype.getCurrentSourceData=function(){if(this.layers.length===0)return[];var e=this.layers.length-1;this.layers[0]._layerBlender=null;for(var t=0;t<e;t++)this.layers[t+1].updateLayerBlending(this.layers[t]);return this.layers[e].getCurrentSourceData()},o.prototype.addLayer=function(e,t){isNaN(t)?this.layers.push(e):this.layers.splice(t,0,e)},o.prototype.resetClips=function(e){for(var t=0;t<this.layers.length;t++)this.layers[t].resetClips(e)},o.prototype.shiftClipTime=function(e){for(var t=0;t<this.layers.length;t++)this.layers[t].shiftClipTime(e)},o.prototype.setTimeScale=function(e){for(var t=0;t<this.layers.length;t++)this.layers[t].setTimeScale(e)},o.prototype.pause=function(){this.paused||(this.lastTimeOfPause=t.time,this.paused=!0)},o.prototype.stop=function(){this._skeletonPose&&this._skeletonPose.setToBindPose(),this.paused=!0,this.lastTimeOfPause=-1},o.prototype.resume=function(){if(this.paused||this.lastTimeOfPause===-1)this.lastTimeOfPause===-1?this.resetClips(t.time):this.shiftClipTime(t.time-this.lastTimeOfPause);this.paused=!1},o.prototype.clone=function(){var e=new o;return e.layers=this.layers.map(function(e){return e.clone()}),e},o}),define("goo/animationpack/handlers/AnimationClipHandler",["goo/loaders/handlers/ConfigHandler","goo/animationpack/clip/AnimationClip","goo/animationpack/clip/JointChannel","goo/animationpack/clip/TransformChannel","goo/animationpack/clip/InterpolatedFloatChannel","goo/animationpack/clip/TriggerChannel","goo/util/PromiseUtil","goo/util/ArrayUtil"],function(e,t,n,r,i,s,o,u){function a(){e.apply(this,arguments)}return a.prototype=Object.create(e.prototype),a.prototype.constructor=a,e._registerClass("clip",a),a.prototype._create=function(){return new t},a.prototype._update=function(t,n,r){var i=this;return e.prototype._update.call(this,t,n,r).then(function(e){return e?i.loadObject(n.binaryRef,r).then(function(t){if(!t)throw new Error("Binary clip data was empty");return i._updateAnimationClip(n,t,e)}):e})},a.prototype._updateAnimationClip=function(e,t,o){o._channels=[];if(e.channels){var a=Object.keys(e.channels);for(var f=0;f<a.length;f++){var l=e.channels[a[f]],c=u.getTypedArray(t,l.times),h=l.blendType,p=l.type,d;switch(p){case"Joint":case"Transform":var v,m,g;v=u.getTypedArray(t,l.rotationSamples),m=u.getTypedArray(t,l.translationSamples),g=u.getTypedArray(t,l.scaleSamples),p==="Joint"?d=new n(l.jointIndex,l.name,c,v,m,g,h):d=new r(l.name,c,v,m,g,h);break;case"FloatLERP":d=new i(l.name,c,l.values,h);break;case"Trigger":d=new s(l.name,c,l.keys),d.guarantee=!!l.guarantee;break;default:console.warn("Unhandled channel type: "+l.type);continue}o.addChannel(d)}}return o},a}),define("goo/animationpack/handlers/AnimationComponentHandler",["goo/loaders/handlers/ComponentHandler","goo/animationpack/components/AnimationComponent","goo/util/rsvp"],function(e,t,n){function r(){e.apply(this,arguments),this._type="AnimationComponent"}return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,e._registerClass("animation",r),r.prototype._create=function(){return new t},r.prototype.update=function(t,r,i){var s=this;return e.prototype.update.call(this,t,r,i).then(function(e){if(!e)return;var t=[],o,u=r.poseRef;u&&(o=s._load(u,i).then(function(t){e._skeletonPose=t}),t.push(o));var a=r.layersRef;return a&&(o=s._load(a,i).then(function(t){e.layers=t,e._layersId=a}),t.push(o)),n.all(t).then(function(){return e})})},r}),define("goo/animationpack/handlers/AnimationLayersHandler",["goo/loaders/handlers/ConfigHandler","goo/animationpack/layer/AnimationLayer","goo/animationpack/layer/LayerLERPBlender","goo/animationpack/state/FadeTransitionState","goo/animationpack/state/SyncFadeTransitionState","goo/animationpack/state/FrozenTransitionState","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,t,n,r,i,s,o,u,a){function f(){e.apply(this,arguments)}return f.prototype=Object.create(e.prototype),f.prototype.constructor=f,e._registerClass("animation",f),f.prototype._create=function(e){return this._objects[e]=[]},f.prototype._setInitialState=function(e,t){if(t){var n=e.getStateById(t);e._currentState!==n&&e.setCurrentStateById(t,!0)}else e.setCurrentState()},f.prototype._update=function(t,n,r){var i=this;return e.prototype._update.call(this,t,n,r).then(function(e){if(!e)return;var t=[],s=0;return a.forEach(n.layers,function(n){t.push(i._parseLayer(n,e[s++],r))},null,"sortValue"),o.all(t).then(function(t){e.length=t.length;for(var n=0;n<t.length;n++)e[n]=t[n];return e})})},f.prototype._parseLayer=function(e,n,r){var i=this;n?n._name=e.name:n=new t(e.name),n.id=e.id,n._transitions=a.deepClone(e.transitions),n._layerBlender&&(e.blendWeight!==undefined?n._layerBlender._blendWeight=e.blendWeight:n._layerBlender._blendWeight=1);var s=[];return a.forEach(e.states,function(e){s.push(i.loadObject(e.stateRef,r).then(function(e){n.setState(e.id,e)}))},null,"sortValue"),o.all(s).then(function(){return i._setInitialState(n,e.initialStateRef),n})},f}),define("goo/animationpack/handlers/AnimationStateHandler",["goo/loaders/handlers/ConfigHandler","goo/animationpack/state/SteadyState","goo/animationpack/blendtree/ClipSource","goo/animationpack/blendtree/ManagedTransformSource","goo/animationpack/blendtree/BinaryLERPSource","goo/animationpack/blendtree/FrozenClipSource","goo/util/rsvp","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,t,n,r,i,s,o,u,a){function f(){e.apply(this,arguments)}return f.prototype=Object.create(e.prototype),f.prototype.constructor=f,e._registerClass("animstate",f),f.prototype._create=function(e){return this._objects[e]=new t},f.prototype._update=function(t,n,r){var i=this;return e.prototype._update.call(this,t,n,r).then(function(e){if(!e)return;return e._name=n.name,e.id=n.id,e._transitions=a.deepClone(n.transitions),i._parseClipSource(n.clipSource,e._sourceTree,r).then(function(t){return e._sourceTree=t,e})})},f.prototype._parseClipSource=function(e,t,a){switch(e.type){case"Clip":return this.loadObject(e.clipRef,a).then(function(r){!t||!t instanceof n?t=new n(r,e.filter,e.channels):(t._clip=r,t.setFilter(e.filter,e.channels)),e.loopCount!==undefined&&(t._clipInstance._loopCount=+e.loopCount),e.timeScale!==undefined&&(t._clipInstance._timeScale=e.timeScale),t._startTime=e.startTime||0;var i=Infinity;for(var s=0;s<r._channels.length;s++){var o=r._channels[s];for(var u=0;u<o._times.length;u++){var a=o._times[u];a<i&&(i=a)}}return t._startTime=Math.max(t._startTime,i),t});case"Managed":if(!t||!t instanceof r)t=new r;return e.clipRef?this.loadObject(e.clipRef,a).then(function(n){return t.initFromClip(n,e.filter,e.channels),t}):u.resolve(t);case"Lerp":var f=[this._parseClipSource(e.clipSourceA,null,a),this._parseClipSource(e.clipSourceB,null,a)];return o.all(f).then(function(n){return t=new i(n[0],n[1]),e.blendWeight&&(t.blendWeight=e.blendWeight),t});case"Frozen":return this._parseClipSource(e.clipSource).then(function(n){return!!t&&t instanceof s?(t._source=n,t._time=e.frozenTime||0):t=new s(n,e.frozenTime||0),t});default:return console.error("Unable to parse clip source"),u.resolve()}},f}),define("goo/animationpack/handlers/SkeletonHandler",["goo/loaders/handlers/ConfigHandler","goo/animationpack/Joint","goo/animationpack/Skeleton","goo/animationpack/SkeletonPose","goo/util/PromiseUtil","goo/util/ObjectUtil"],function(e,t,n,r,i,s){function o(){e.apply(this,arguments)}return o.prototype=Object.create(e.prototype),o.prototype.constructor=o,e._registerClass("skeleton",o),o.prototype._update=function(e,o){if(!this._objects[e]){if(!o)return i.resolve();var u=[];s.forEach(o.joints,function(e){var n=new t(e.name);n._index=e.index,n._parentIndex=e.parentIndex,n._inverseBindPose.matrix.data.set(e.inverseBindPose),u.push(n)},null,"index");var a=new n(o.name,u),f=new r(a);f.setToBindPose(),this._objects[e]=f}return i.resolve(this._objects[e])},o}),define("goo/animationpack/systems/AnimationSystem",["goo/entities/systems/System","goo/entities/World"],function(e,t){function n(){e.call(this,"AnimationSystem",["AnimationComponent"])}return n.prototype=Object.create(e.prototype),n.prototype.process=function(){for(var e=0;e<this._activeEntities.length;e++){var n=this._activeEntities[e],r=n.animationComponent;r.update(t.time),r.apply(n.transformComponent),r.postUpdate()}},n.prototype.pause=function(){this.passive=!0;for(var e=0;e<this._activeEntities.length;e++)this._activeEntities[e].animationComponent.pause()},n.prototype.stop=function(){this.passive=!0;for(var e=0;e<this._activeEntities.length;e++){var t=this._activeEntities[e];t.animationComponent.stop()}},n.prototype.resume=function(){this.passive=!1;for(var e=0;e<this._activeEntities.length;e++){var t=this._activeEntities[e];t.animationComponent.resume()}},n}),require(["goo/animationpack/AnimationRegister","goo/animationpack/Joint","goo/animationpack/Skeleton","goo/animationpack/SkeletonPose","goo/animationpack/blendtree/BinaryLERPSource","goo/animationpack/blendtree/ClipSource","goo/animationpack/blendtree/FrozenClipSource","goo/animationpack/blendtree/ManagedTransformSource","goo/animationpack/clip/AbstractAnimationChannel","goo/animationpack/clip/AnimationClip","goo/animationpack/clip/AnimationClipInstance","goo/animationpack/clip/InterpolatedFloatChannel","goo/animationpack/clip/JointChannel","goo/animationpack/clip/JointData","goo/animationpack/clip/TransformChannel","goo/animationpack/clip/TransformData","goo/animationpack/clip/TriggerChannel","goo/animationpack/clip/TriggerData","goo/animationpack/components/AnimationComponent","goo/animationpack/handlers/AnimationClipHandler","goo/animationpack/handlers/AnimationComponentHandler","goo/animationpack/handlers/AnimationLayersHandler","goo/animationpack/handlers/AnimationStateHandler","goo/animationpack/handlers/SkeletonHandler","goo/animationpack/layer/AnimationLayer","goo/animationpack/layer/LayerLERPBlender","goo/animationpack/state/AbstractState","goo/animationpack/state/AbstractTransitionState","goo/animationpack/state/FadeTransitionState","goo/animationpack/state/FrozenTransitionState","goo/animationpack/state/SteadyState","goo/animationpack/state/SyncFadeTransitionState","goo/animationpack/systems/AnimationSystem"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_){var D=window.goo;if(!D)return;D.AnimationRegister=e,D.Joint=t,D.Skeleton=n,D.SkeletonPose=r,D.BinaryLERPSource=i,D.ClipSource=s,D.FrozenClipSource=o,D.ManagedTransformSource=u,D.AbstractAnimationChannel=a,D.AnimationClip=f,D.AnimationClipInstance=l,D.InterpolatedFloatChannel=c,D.JointChannel=h,D.JointData=p,D.TransformChannel=d,D.TransformData=v,D.TriggerChannel=m,D.TriggerData=g,D.AnimationComponent=y,D.AnimationClipHandler=b,D.AnimationComponentHandler=w,D.AnimationLayersHandler=E,D.AnimationStateHandler=S,D.SkeletonHandler=x,D.AnimationLayer=T,D.LayerLERPBlender=N,D.AbstractState=C,D.AbstractTransitionState=k,D.FadeTransitionState=L,D.FrozenTransitionState=A,D.SteadyState=O,D.SyncFadeTransitionState=M,D.AnimationSystem=_}),define("goo/animationpack/animationpack",function(){});
}try{
if(window.localStorage&&window.localStorage.gooPath){
window.require.config({
paths:{goo:localStorage.gooPath}
});
}else f()
}catch(e){f()}
})(window)